rn[rn == "GCS_Cat"] <- "Enrollment GCS"
rn[rn == "Age_Cat"] <- "Age in Years"
rn[rn == "Haematoma_volume"] <- "ICH Volume (cc)"
rn[rn == "Lobar_BG_vs"] <- "Clot Site"
is.var <- apply(tab, 1, function(x) all(x ==""))
rn[!is.var] <- paste0("ZZZ", rn[!is.var])
rn[rn == "ZZZAge2"] <- "Age in Years: Median (IQR)"
rn[rn == "ZZZAge"] <- "Age in Years: Mean (SD)"
rn[rn == "ZZZEnrollment_GCS_Add"] <- "Enrollment GCS: Mean (SD)"
rn[rn == "ZZZICHVolume"] <- "ICH Volume (cc): Mean (SD)"
rn[rn == "ZZZICHVolume2"] <- "ICH Volume (cc): Median (IQR)"
rn[rn == "ZZZIVHVolume"] <- "IVH Volume (cc): Mean (SD)"
rn[rn == "ZZZIVHVolume2"] <- "IVH Volume (cc): Median (IQR)"
rn[rn == "ZZZPrognostic_Score"] <- "Prognostic Score: Mean (SD)"
rn[rn == "ZZZEnrollment_NIHSS_Total"] <- "Enrollment NIHSS: Mean (SD)"
rn[rn == "ZZZPrognostic_Score2"] <- "Prognostic Score: Median (IQR)"
rn[rn == "ZZZSurgery_Time"] <- "Ictus to Surgery"
rn[rn == "ZZZsystolic"] <- "Systolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZdiastolic"] <- "Diastolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZRandomization_to_Op_Procedure"] <- "Randomization to Surgery (Hours)"
rn[rn == "ZZZTurhim"] <- "Turhim Score"
rn[rn == "ZZZHemphill"] <- "Hemphill Score: Mean (SD)"
rn[rn == "ZZZIctus_to_Enrolled"] <- "Ictus to Randomization (Days)"
rn[rn == "ZZZAny_IVH"] <- "Any IVH Present at Randomization"
rn[rn == "ZZZDiabetes"] <- "Diabetes"
rn[rn == "ZZZHypertension"] <- "History of Hypertension"
rn[rn == "ZZZOther_CV"] <- "Other Cardiovascular Disease"
rn[rn == "ZZZETOH_Abuse"] <- "Alcohol Abuse"
rn[rn == "ZZZGender"] <- "Gender: Male"
rn <- gsub("_", " ", rn)
rownames(tab) <- rn
tt <- table(data[, group])
if (runall){
tt = c(tt, All = sum(tt))
}
tab <- data.frame(tab, stringsAsFactors=FALSE)
tab$Medical <- gsub("NaN (NA)", NA, tab$Medical, fixed=TRUE)
colnames(tab) <- paste0(names(tt), " (N=",tt, ")")
eval(parse(text=paste0("tab.", idat, " <- tab")))
}
vari = "Randomization_to_Op_Procedure"
data$group <- data[, groupvar]
data$Var <- data[, vari]
#   tab <- ddply(data, .(group), summarize, mean=mean(Var, na.rm=unique(nrm)), sd=sd(Var, na.rm=nrm), min=min(Var, na.rm=nrm), max=max(Var, na.rm=nrm), median=median(Var, na.rm=nrm), p25=p25(Var, na.rm=nrm), p75=p75(Var, na.rm=nrm))
#   if (na.rm) data <- data[ !is.na(data$Var), ]
tab <- ddply(data, .(group), summarize, mean=mean(Var, na.rm=TRUE), sd=sd(Var, na.rm=TRUE), min=min(Var, na.rm=TRUE), max=max(Var, na.rm=TRUE), median=median(Var, na.rm=TRUE), p25=p25(Var, na.rm=TRUE), p75=p75(Var, na.rm=TRUE))
if (runall) {
tab.all <- with(data,
data.frame(group = allname, mean=mean(Var, na.rm=TRUE),
sd=sd(Var, na.rm=TRUE),
min=min(Var, na.rm=TRUE),
max=max(Var, na.rm=TRUE),
median=median(Var, na.rm=TRUE),
p25=p25(Var, na.rm=TRUE),
p75=p75(Var, na.rm=TRUE)))
tab = rbind(tab, tab.all)
}
tg = tab[, "group"]
#p25=quantile(Var, probs=0.25), p75=quantile(Var, probs=0.75)
#
ttab <- tab[, !colnames(tab) %in% c("Group_Assigned", "group")]
ttab <- round(ttab, digit)
ttab$iqr <-paste0(ttab$p25, " - ", ttab$p75)
ttab <- matrix(paste0(ttab[,est1], " (", ttab[, est2], ")"), ncol=nrow(ttab))
rownames(ttab) <- vari
colnames(ttab) <- tab[, group]
est1 = "mean"
est2  = "sd"
data$group <- data[, groupvar]
data$Var <- data[, vari]
#   tab <- ddply(data, .(group), summarize, mean=mean(Var, na.rm=unique(nrm)), sd=sd(Var, na.rm=nrm), min=min(Var, na.rm=nrm), max=max(Var, na.rm=nrm), median=median(Var, na.rm=nrm), p25=p25(Var, na.rm=nrm), p75=p75(Var, na.rm=nrm))
#   if (na.rm) data <- data[ !is.na(data$Var), ]
tab <- ddply(data, .(group), summarize, mean=mean(Var, na.rm=TRUE), sd=sd(Var, na.rm=TRUE), min=min(Var, na.rm=TRUE), max=max(Var, na.rm=TRUE), median=median(Var, na.rm=TRUE), p25=p25(Var, na.rm=TRUE), p75=p75(Var, na.rm=TRUE))
if (runall) {
tab.all <- with(data,
data.frame(group = allname, mean=mean(Var, na.rm=TRUE),
sd=sd(Var, na.rm=TRUE),
min=min(Var, na.rm=TRUE),
max=max(Var, na.rm=TRUE),
median=median(Var, na.rm=TRUE),
p25=p25(Var, na.rm=TRUE),
p75=p75(Var, na.rm=TRUE)))
tab = rbind(tab, tab.all)
}
tg = tab[, "group"]
#p25=quantile(Var, probs=0.25), p75=quantile(Var, probs=0.75)
#
ttab <- tab[, !colnames(tab) %in% c("Group_Assigned", "group")]
ttab <- round(ttab, digit)
ttab$iqr <-paste0(ttab$p25, " - ", ttab$p75)
ttab <- matrix(paste0(ttab[,est1], " (", ttab[, est2], ")"), ncol=nrow(ttab))
rownames(ttab) <- vari
colnames(ttab) <- tab[, group]
tab
ttabg
tttab
ttab
length(unique(data$group)) != 2
length(unique(data$group))
length(unique(data$group[!is.na(data$Var)]))
rep("hey", 0)
knit("Manuscript_2013Dec30.Rnw", envir = .GlobalEnv)
run_cat
data = rando
group
run_cat(data, vari="Surgery_Time")
vari="Surgery_Time"
tab <- table(data[,vari], data[, groupvar], useNA="ifany")
groupvar = "group"
tab <- table(data[,vari], data[, groupvar], useNA="ifany")
tab
nona = tab[!is.na(rownames(tab)),]
nona
nona = colSums(nona)
nona
sum(nona != 0) <= 1
knit("Manuscript_2013Dec30.Rnw", envir = .GlobalEnv)
est <- "sd"
digit <- 1
data <- alldat
maketwo <- c("Age", "Enrollment_GCS_Add", "ICHVolume", "IVHVolume", "Prognostic_Score", "Hemphill", "Tuhrim")
for (icol in maketwo) {
nname <- paste0(icol, "2")
alldat[, nname] <- alldat[, icol]
rando[, nname] <- rando[, icol]
}
for (idat in c("rando", "alldat")){
#   eval(parse(text=paste("data <- ", idat)))
data = get(idat)
group <- "group"
tab <- NULL
tab <- rbind(tab, run_contin(data, vari="Age", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="Age2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Age_Cat"))
tab <- rbind(tab, run_cat(data, vari="Gender", level="Male", yesno=TRUE))
#   tab <- rbind(tab, run_cat(data, vari="Ethnicity"))
tab <- rbind(tab, run_cat(data, vari="Race"))
tab <- rbind(tab, run_contin(data, vari="Enrollment_GCS_Add", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_cat(data, vari="GCS_Cat"))
tab <- rbind(tab, run_contin(data, vari="Enrollment_NIHSS_Total", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="systolic"))
tab <- rbind(tab, run_contin(data, vari="diastolic"))
tab <- rbind(tab, run_cat(data, vari="Diabetes", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="Hypertension", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="Other_CV", level="Abnormal", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="ETOH_Abuse", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_contin(data, vari="ICHVolume", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="ICHVolume2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Haematoma_volume"))
tab <- rbind(tab, run_contin(data, vari="IVHVolume", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="IVHVolume2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Clot_Location_RC"))
tab <- rbind(tab, run_cat(data, vari="Lobar_BG_vs"))
tab <- rbind(tab, run_contin(data, vari="Ictus_to_Enrolled"))
tab <- rbind(tab, run_contin(data, vari="Randomization_to_Op_Procedure", na.rm=TRUE))
tab <- rbind(tab, run_cat(data, vari="Surgery_Time"))
tab <- rbind(tab, run_contin(data, vari="Tuhrim"))
tab <- rbind(tab, run_contin(data, vari="Prognostic_Score"))
tab <- rbind(tab, run_contin(data, vari="Prognostic_Score2", est1="median", est2="iqr", digit=digit))
tab <- rbind(tab, run_contin(data, vari="Hemphill"))
tab <- rbind(tab, run_cat(data, vari="Hemphill_Score"))
# tab <- rbind(tab, run_contin(data, vari="Ictus_to_Op_Procedure", est, digit))
tab[tab == "0 (NaN%)"] <- "NA"
tab[tab == "NA (NA)"] <- "NA"
rn <- rownames(tab)
tab[rn %in% c("<= 36 Hours", "> 36 Hours"), "Medical"] <- NA
rn[rn == "Clot_Location_RC"] <- "Clot Location"
rn[rn == "GCS_Cat"] <- "Enrollment GCS"
rn[rn == "Age_Cat"] <- "Age in Years"
rn[rn == "Haematoma_volume"] <- "ICH Volume (cc)"
rn[rn == "Lobar_BG_vs"] <- "Clot Site"
is.var <- apply(tab, 1, function(x) all(x ==""))
rn[!is.var] <- paste0("ZZZ", rn[!is.var])
rn[rn == "ZZZAge2"] <- "Age in Years: Median (IQR)"
rn[rn == "ZZZAge"] <- "Age in Years: Mean (SD)"
rn[rn == "ZZZEnrollment_GCS_Add"] <- "Enrollment GCS: Mean (SD)"
rn[rn == "ZZZICHVolume"] <- "ICH Volume (cc): Mean (SD)"
rn[rn == "ZZZICHVolume2"] <- "ICH Volume (cc): Median (IQR)"
rn[rn == "ZZZIVHVolume"] <- "IVH Volume (cc): Mean (SD)"
rn[rn == "ZZZIVHVolume2"] <- "IVH Volume (cc): Median (IQR)"
rn[rn == "ZZZPrognostic_Score"] <- "Prognostic Score: Mean (SD)"
rn[rn == "ZZZEnrollment_NIHSS_Total"] <- "Enrollment NIHSS: Mean (SD)"
rn[rn == "ZZZPrognostic_Score2"] <- "Prognostic Score: Median (IQR)"
rn[rn == "ZZZSurgery_Time"] <- "Ictus to Surgery"
rn[rn == "ZZZsystolic"] <- "Systolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZdiastolic"] <- "Diastolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZRandomization_to_Op_Procedure"] <- "Randomization to Surgery (Hours)"
rn[rn == "ZZZTuhrim"] <- "Tuhrim Score"
rn[rn == "ZZZHemphill"] <- "Hemphill Score: Mean (SD)"
rn[rn == "ZZZIctus_to_Enrolled"] <- "Ictus to Randomization (Days)"
rn[rn == "ZZZAny_IVH"] <- "Any IVH Present at Randomization"
rn[rn == "ZZZDiabetes"] <- "Diabetes"
rn[rn == "ZZZHypertension"] <- "History of Hypertension"
rn[rn == "ZZZOther_CV"] <- "Other Cardiovascular Disease"
rn[rn == "ZZZETOH_Abuse"] <- "Alcohol Abuse"
rn[rn == "ZZZGender"] <- "Gender: Male"
rn <- gsub("_", " ", rn)
rownames(tab) <- rn
tt <- table(data[, group])
if (runall){
tt = c(tt, All = sum(tt))
}
tab <- data.frame(tab, stringsAsFactors=FALSE)
tab$Medical <- gsub("NaN (NA)", NA, tab$Medical, fixed=TRUE)
colnames(tab) <- paste0(names(tt), " (N=",tt, ")")
eval(parse(text=paste0("tab.", idat, " <- tab")))
}
for (icol in maketwo) {
nname <- paste0(icol, "2")
alldat[, nname] <- NULL
rando[, nname] <- NULL
}
groups <- c("all randomized", "all")
caps <- paste0("Demographic and protocol information, medical history, and clot characteristics for ", groups, " by group assigned")
figcap.demog <- paste0("Demographic and protocol information, medical history, and clot characteristics for randomized Medical and MIS groups, and randomized MIS + run-in MIS patients.  Prognostic score was calculated by the following equation: GCS*10 - Age - 0.64 * ICH Volume \\citep{mendelow}.  Also, including the MIS run-in patients (N=27) did not change the distribution of characteristics largely compared to the randomized MIS group." )
addtorow <- list()
addtorow$pos <- list()
addtorow$pos[[1]] <- 0
addtorow$command <- c("\\hline & \\multicolumn{2}{c}{N\\% or Mean(SD)} \\\\ ")
xtab.rando <- xtable(tab.rando, align=ifelse(runall, "lcccc", "lccc"))
est <- "sd"
digit <- 1
data <- alldat
maketwo <- c("Age", "Enrollment_GCS_Add", "ICHVolume", "IVHVolume", "Prognostic_Score", "Hemphill", "Tuhrim")
for (icol in maketwo) {
nname <- paste0(icol, "2")
alldat[, nname] <- alldat[, icol]
rando[, nname] <- rando[, icol]
}
for (idat in c("rando", "alldat")){
#   eval(parse(text=paste("data <- ", idat)))
data = get(idat)
group <- "group"
tab <- NULL
tab <- rbind(tab, run_contin(data, vari="Age", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="Age2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Age_Cat"))
tab <- rbind(tab, run_cat(data, vari="Gender", level="Male", yesno=TRUE))
#   tab <- rbind(tab, run_cat(data, vari="Ethnicity"))
tab <- rbind(tab, run_cat(data, vari="Race"))
tab <- rbind(tab, run_contin(data, vari="Enrollment_GCS_Add", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_cat(data, vari="GCS_Cat"))
tab <- rbind(tab, run_contin(data, vari="Enrollment_NIHSS_Total", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="systolic"))
tab <- rbind(tab, run_contin(data, vari="diastolic"))
tab <- rbind(tab, run_cat(data, vari="Diabetes", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="Hypertension", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="Other_CV", level="Abnormal", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="ETOH_Abuse", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_contin(data, vari="ICHVolume", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="ICHVolume2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Haematoma_volume"))
tab <- rbind(tab, run_contin(data, vari="IVHVolume", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="IVHVolume2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Clot_Location_RC"))
tab <- rbind(tab, run_cat(data, vari="Lobar_BG_vs"))
tab <- rbind(tab, run_contin(data, vari="Ictus_to_Enrolled"))
tab <- rbind(tab, run_contin(data, vari="Randomization_to_Op_Procedure", na.rm=TRUE))
tab <- rbind(tab, run_cat(data, vari="Surgery_Time"))
tab <- rbind(tab, run_contin(data, vari="Tuhrim"))
tab <- rbind(tab, run_contin(data, vari="Prognostic_Score"))
tab <- rbind(tab, run_contin(data, vari="Prognostic_Score2", est1="median", est2="iqr", digit=digit))
tab <- rbind(tab, run_contin(data, vari="Hemphill"))
tab <- rbind(tab, run_cat(data, vari="Hemphill_Score"))
# tab <- rbind(tab, run_contin(data, vari="Ictus_to_Op_Procedure", est, digit))
tab[tab == "0 (NaN%)"] <- "NA"
tab[tab == "NA (NA)"] <- "NA"
rn <- rownames(tab)
tab[rn %in% c("<= 36 Hours", "> 36 Hours"), "Medical"] <- NA
rn[rn == "Clot_Location_RC"] <- "Clot Location"
rn[rn == "GCS_Cat"] <- "Enrollment GCS"
rn[rn == "Age_Cat"] <- "Age in Years"
rn[rn == "Haematoma_volume"] <- "ICH Volume (cc)"
rn[rn == "Lobar_BG_vs"] <- "Clot Site"
is.var <- apply(tab, 1, function(x) all(x ==""))
rn[!is.var] <- paste0("ZZZ", rn[!is.var])
rn[rn == "ZZZAge2"] <- "Age in Years: Median (IQR)"
rn[rn == "ZZZAge"] <- "Age in Years: Mean (SD)"
rn[rn == "ZZZEnrollment_GCS_Add"] <- "Enrollment GCS: Mean (SD)"
rn[rn == "ZZZICHVolume"] <- "ICH Volume (cc): Mean (SD)"
rn[rn == "ZZZICHVolume2"] <- "ICH Volume (cc): Median (IQR)"
rn[rn == "ZZZIVHVolume"] <- "IVH Volume (cc): Mean (SD)"
rn[rn == "ZZZIVHVolume2"] <- "IVH Volume (cc): Median (IQR)"
rn[rn == "ZZZPrognostic_Score"] <- "Prognostic Score: Mean (SD)"
rn[rn == "ZZZEnrollment_NIHSS_Total"] <- "Enrollment NIHSS: Mean (SD)"
rn[rn == "ZZZPrognostic_Score2"] <- "Prognostic Score: Median (IQR)"
rn[rn == "ZZZSurgery_Time"] <- "Ictus to Surgery"
rn[rn == "ZZZsystolic"] <- "Systolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZdiastolic"] <- "Diastolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZRandomization_to_Op_Procedure"] <- "Randomization to Surgery (Hours)"
rn[rn == "ZZZTuhrim"] <- "Tuhrim Score"
rn[rn == "ZZZHemphill"] <- "Hemphill Score: Mean (SD)"
rn[rn == "ZZZIctus_to_Enrolled"] <- "Ictus to Randomization (Days)"
rn[rn == "ZZZAny_IVH"] <- "Any IVH Present at Randomization"
rn[rn == "ZZZDiabetes"] <- "Diabetes"
rn[rn == "ZZZHypertension"] <- "History of Hypertension"
rn[rn == "ZZZOther_CV"] <- "Other Cardiovascular Disease"
rn[rn == "ZZZETOH_Abuse"] <- "Alcohol Abuse"
rn[rn == "ZZZGender"] <- "Gender: Male"
rn <- gsub("_", " ", rn)
rownames(tab) <- rn
tt <- table(data[, group])
if (runall){
tt = c(tt, All = sum(tt))
}
tab <- data.frame(tab, stringsAsFactors=FALSE)
tab$Medical <- gsub("NaN (NA)", NA, tab$Medical, fixed=TRUE)
colnames(tab) <- paste0(names(tt), " (N=",tt, ")")
eval(parse(text=paste0("tab.", idat, " <- tab")))
}
for (icol in maketwo) {
nname <- paste0(icol, "2")
alldat[, nname] <- NULL
rando[, nname] <- NULL
}
groups <- c("all randomized", "all")
caps <- paste0("Demographic and protocol information, medical history, and clot characteristics for ", groups, " by group assigned")
figcap.demog <- paste0("Demographic and protocol information, medical history, and clot characteristics for randomized Medical and MIS groups, and randomized MIS + run-in MIS patients.  Prognostic score was calculated by the following equation: GCS*10 - Age - 0.64 * ICH Volume \\citep{mendelow}.  Also, including the MIS run-in patients (N=27) did not change the distribution of characteristics largely compared to the randomized MIS group." )
addtorow <- list()
addtorow$pos <- list()
addtorow$pos[[1]] <- 0
addtorow$command <- c("\\hline & \\multicolumn{2}{c}{N\\% or Mean(SD)} \\\\ ")
xtab.rando <- xtable(tab.rando, align=ifelse(runall, "lcccc", "lccc"))
is.var
tab
is.var <- apply(tab, 1, function(x) all(x %in% c("", NA)))
is.var
run_contin <- function(data, vari, est1="mean", est2="sd", digit=1, groupvar ="group", pvalue = TRUE,  ...){
data$group <- data[, groupvar]
data$Var <- data[, vari]
#   tab <- ddply(data, .(group), summarize, mean=mean(Var, na.rm=unique(nrm)), sd=sd(Var, na.rm=nrm), min=min(Var, na.rm=nrm), max=max(Var, na.rm=nrm), median=median(Var, na.rm=nrm), p25=p25(Var, na.rm=nrm), p75=p75(Var, na.rm=nrm))
#   if (na.rm) data <- data[ !is.na(data$Var), ]
tab <- ddply(data, .(group), summarize, mean=mean(Var, na.rm=TRUE), sd=sd(Var, na.rm=TRUE), min=min(Var, na.rm=TRUE), max=max(Var, na.rm=TRUE), median=median(Var, na.rm=TRUE), p25=p25(Var, na.rm=TRUE), p75=p75(Var, na.rm=TRUE))
if (runall) {
tab.all <- with(data,
data.frame(group = allname, mean=mean(Var, na.rm=TRUE),
sd=sd(Var, na.rm=TRUE),
min=min(Var, na.rm=TRUE),
max=max(Var, na.rm=TRUE),
median=median(Var, na.rm=TRUE),
p25=p25(Var, na.rm=TRUE),
p75=p75(Var, na.rm=TRUE)))
tab = rbind(tab, tab.all)
}
tg = tab[, "group"]
#p25=quantile(Var, probs=0.25), p75=quantile(Var, probs=0.75)
#
ttab <- tab[, !colnames(tab) %in% c("Group_Assigned", "group")]
ttab <- round(ttab, digit)
ttab$iqr <-paste0(ttab$p25, " - ", ttab$p75)
ttab <- matrix(paste0(ttab[,est1], " (", ttab[, est2], ")"), ncol=nrow(ttab))
rownames(ttab) <- vari
colnames(ttab) <- tab[, group]
if (pvalue){
if (length(unique(data$group[!is.na(data$Var)])) != 2){
pval = NA
} else {
tt = t.test(Var ~ group, data = data)
pval = tt$p.value
}
} else {
pval = NA
}
ttab = cbind(ttab, p.value = c(pvaller(pval), rep("", nrow(ttab)-1)))
return(ttab)
}
run_cat <- function(data, vari, level=NULL, yesno=FALSE, groupvar="group",
pvalue = TRUE){
tab <- table(data[,vari], data[, groupvar], useNA="ifany")
nona = tab[!is.na(rownames(tab)),]
nona = colSums(nona)
if (pvalue){
tt = fisher.test(tab)
pval = tt$p.value
if (sum(nona != 0) <= 1){
pval = NA
}
} else {
pval = NA
}
if (runall){
tab = cbind(tab, rowSums(tab))
colnames(tab)[ncol(tab)] = allname
}
ptab <- prop.table(tab, 2)
Npct <- matrix(paste(tab, " (", round(ptab*100, 1), "%)", sep=""), dimnames=dimnames(tab), ncol=ncol(tab), nrow=nrow(tab))
if (!is.null(level)) {
Npct <- Npct[level, , drop=FALSE]
}
Npct <- Npct[!is.na(rownames(Npct)),, drop=FALSE]
if (yesno){
rownames(Npct) <- vari
} else {
rn <- rownames(Npct)
Npct <- rbind(rep("", length.out = ncol(Npct)), Npct)
rownames(Npct) <- c(vari, rn)
}
#   if (pvalue){
Npct = cbind(Npct,
p.value = c(pvaller(pval), rep("", nrow(Npct)-1))
)
#   }
return(Npct)
}
est <- "sd"
digit <- 1
data <- alldat
maketwo <- c("Age", "Enrollment_GCS_Add", "ICHVolume", "IVHVolume", "Prognostic_Score", "Hemphill", "Tuhrim")
for (icol in maketwo) {
nname <- paste0(icol, "2")
alldat[, nname] <- alldat[, icol]
rando[, nname] <- rando[, icol]
}
for (idat in c("rando", "alldat")){
#   eval(parse(text=paste("data <- ", idat)))
data = get(idat)
group <- "group"
tab <- NULL
tab <- rbind(tab, run_contin(data, vari="Age", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="Age2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Age_Cat"))
tab <- rbind(tab, run_cat(data, vari="Gender", level="Male", yesno=TRUE))
#   tab <- rbind(tab, run_cat(data, vari="Ethnicity"))
tab <- rbind(tab, run_cat(data, vari="Race"))
tab <- rbind(tab, run_contin(data, vari="Enrollment_GCS_Add", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_cat(data, vari="GCS_Cat"))
tab <- rbind(tab, run_contin(data, vari="Enrollment_NIHSS_Total", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="systolic"))
tab <- rbind(tab, run_contin(data, vari="diastolic"))
tab <- rbind(tab, run_cat(data, vari="Diabetes", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="Hypertension", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="Other_CV", level="Abnormal", yesno=TRUE))
tab <- rbind(tab, run_cat(data, vari="ETOH_Abuse", level="Yes", yesno=TRUE))
tab <- rbind(tab, run_contin(data, vari="ICHVolume", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="ICHVolume2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Haematoma_volume"))
tab <- rbind(tab, run_contin(data, vari="IVHVolume", est2=est, digit=digit, na.rm=FALSE))
tab <- rbind(tab, run_contin(data, vari="IVHVolume2", est1="median", est2="iqr", digit=digit, na.rm=FALSE, pvalue=FALSE))
#   tab <- rbind(tab, run_cat(data, vari="Clot_Location_RC"))
tab <- rbind(tab, run_cat(data, vari="Lobar_BG_vs"))
tab <- rbind(tab, run_contin(data, vari="Ictus_to_Enrolled"))
tab <- rbind(tab, run_contin(data, vari="Randomization_to_Op_Procedure", na.rm=TRUE))
tab <- rbind(tab, run_cat(data, vari="Surgery_Time"))
tab <- rbind(tab, run_contin(data, vari="Tuhrim"))
tab <- rbind(tab, run_contin(data, vari="Prognostic_Score"))
tab <- rbind(tab, run_contin(data, vari="Prognostic_Score2", est1="median", est2="iqr", digit=digit))
tab <- rbind(tab, run_contin(data, vari="Hemphill"))
tab <- rbind(tab, run_cat(data, vari="Hemphill_Score"))
# tab <- rbind(tab, run_contin(data, vari="Ictus_to_Op_Procedure", est, digit))
tab[tab == "0 (NaN%)"] <- "NA"
tab[tab == "NA (NA)"] <- "NA"
rn <- rownames(tab)
tab[rn %in% c("<= 36 Hours", "> 36 Hours"), "Medical"] <- NA
rn[rn == "Clot_Location_RC"] <- "Clot Location"
rn[rn == "GCS_Cat"] <- "Enrollment GCS"
rn[rn == "Age_Cat"] <- "Age in Years"
rn[rn == "Haematoma_volume"] <- "ICH Volume (cc)"
rn[rn == "Lobar_BG_vs"] <- "Clot Site"
is.var <- apply(tab, 1, function(x) all(x %in% c("", NA)))
rn[!is.var] <- paste0("ZZZ", rn[!is.var])
rn[rn == "ZZZAge2"] <- "Age in Years: Median (IQR)"
rn[rn == "ZZZAge"] <- "Age in Years: Mean (SD)"
rn[rn == "ZZZEnrollment_GCS_Add"] <- "Enrollment GCS: Mean (SD)"
rn[rn == "ZZZICHVolume"] <- "ICH Volume (cc): Mean (SD)"
rn[rn == "ZZZICHVolume2"] <- "ICH Volume (cc): Median (IQR)"
rn[rn == "ZZZIVHVolume"] <- "IVH Volume (cc): Mean (SD)"
rn[rn == "ZZZIVHVolume2"] <- "IVH Volume (cc): Median (IQR)"
rn[rn == "ZZZPrognostic_Score"] <- "Prognostic Score: Mean (SD)"
rn[rn == "ZZZEnrollment_NIHSS_Total"] <- "Enrollment NIHSS: Mean (SD)"
rn[rn == "ZZZPrognostic_Score2"] <- "Prognostic Score: Median (IQR)"
rn[rn == "ZZZSurgery_Time"] <- "Ictus to Surgery"
rn[rn == "ZZZsystolic"] <- "Systolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZdiastolic"] <- "Diastolic BP (mmHg): Mean (SD)"
rn[rn == "ZZZRandomization_to_Op_Procedure"] <- "Randomization to Surgery (Hours)"
rn[rn == "ZZZTuhrim"] <- "Tuhrim Score"
rn[rn == "ZZZHemphill"] <- "Hemphill Score: Mean (SD)"
rn[rn == "ZZZIctus_to_Enrolled"] <- "Ictus to Randomization (Days)"
rn[rn == "ZZZAny_IVH"] <- "Any IVH Present at Randomization"
rn[rn == "ZZZDiabetes"] <- "Diabetes"
rn[rn == "ZZZHypertension"] <- "History of Hypertension"
rn[rn == "ZZZOther_CV"] <- "Other Cardiovascular Disease"
rn[rn == "ZZZETOH_Abuse"] <- "Alcohol Abuse"
rn[rn == "ZZZGender"] <- "Gender: Male"
rn <- gsub("_", " ", rn)
rownames(tab) <- rn
tt <- table(data[, group])
if (runall){
tt = c(tt, All = sum(tt))
}
tab <- data.frame(tab, stringsAsFactors=FALSE)
tab$Medical <- gsub("NaN (NA)", NA, tab$Medical, fixed=TRUE)
colnames(tab) <- paste0(names(tt), " (N=",tt, ")")
eval(parse(text=paste0("tab.", idat, " <- tab")))
}
for (icol in maketwo) {
nname <- paste0(icol, "2")
alldat[, nname] <- NULL
rando[, nname] <- NULL
}
groups <- c("all randomized", "all")
caps <- paste0("Demographic and protocol information, medical history, and clot characteristics for ", groups, " by group assigned")
figcap.demog <- paste0("Demographic and protocol information, medical history, and clot characteristics for randomized Medical and MIS groups, and randomized MIS + run-in MIS patients.  Prognostic score was calculated by the following equation: GCS*10 - Age - 0.64 * ICH Volume \\citep{mendelow}.  Also, including the MIS run-in patients (N=27) did not change the distribution of characteristics largely compared to the randomized MIS group." )
addtorow <- list()
addtorow$pos <- list()
addtorow$pos[[1]] <- 0
addtorow$command <- c("\\hline & \\multicolumn{2}{c}{N\\% or Mean(SD)} \\\\ ")
xtab.rando <- xtable(tab.rando, align=ifelse(runall, "lcccc", "lccc"))
tab.rando
library(knitr)
opts_chunk$set(echo=FALSE, prompt=FALSE, message=FALSE, warning=FALSE, comment="", results='hide')
setwd("~/CT_Registration/RIP_SlideDeck/")
df
